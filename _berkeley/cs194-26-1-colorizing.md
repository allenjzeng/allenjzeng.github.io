---
layout:      project  # Must be set to project
date:        1 Jun 2017
title:       Colorizing the Prokudin-Gorskii Collection
caption:     5D image alignment, optimizing for (x, y) translation, (x, y) scale, and rotation.
image:
  path:      /assets/thumb/cs194-26-1.webp
  srcset:
    1083w:   /assets/thumb/cs194-26-1.webp
    960w:    /assets/thumb/cs194-26-1@960w.webp
    480w:    /assets/thumb/cs194-26-1@480w.webp
    240w:    /assets/thumb/cs194-26-1@240w.webp
description: >
  The three black and white images on the left were taken before color photography was invented, using different color filters in front of the camera. By aligning these images across different color channels, we can produce the full-color photograph on the right.
# links:
#   - title:   Demo
#     url:     /assets/pdf/pdf.pdf
featured:    false
sitemap:     true
---


# Colorizing the Prokudin-Gorskii Collection

## Premise

The Prokudin-Gorskii Collection features copies of glass plates, where each copy consists of three separate images that were taken with different filters. The three separate images correspond to different color channels. For this project, the top image corresponds to blue, the middle to green, and the bottom to red. The goal of this project is to automatically align the three images for the various plates using fixed parameters among all images. Meaning that parameters are chosen at the start of the algorithm, and then the same algorithm is applied to all plates.


## Algorithm Overview

The skeleton of the algorithm is as follows. First, the three panel plate is separated into three separate and equally sized 2D image matrices. Each 2D matrix represents one color channel. Then the three matrices are aligned, and stacked into one final image. Different image processing techniques can be applied between those steps, which we will discuss later. The main part of this algorithm is the alignment function.

In order to measure the "alignment" of two channels, I used the Normalized Cross Correlation (NCC) metric. Images are naturally 2D matrices, but they are flattened to vector form for the following calculation. Given an image $$a$$ (in vector form) in one channel and an image $$b$$ (in vector form) in another channel

$$ ncc = < \frac{a}{||a|| _ {F}} , \frac{b}{||b|| _ {F}} > $$

Where \\(\|\|\cdot\|\|\_{F}\\) is the Frobenius norm, and $$<\cdot,\cdot>$$ is a dot product. Higher $$ncc$$ values mean that $$a$$ and $$b$$ are more similar and are therefore better aligned.

With that metric in mind, the first channel is translated both vertically and horizontally in search for the best alignment with the second. And then the second channel is aligned with the third. The three channels are stacked to create the colored output image.



## Algorithm In Depth

First, the three channels are obtained. Note that the original three-panel image has borders around each panel. So, **7%** of each side of each channel is cropped out. This value was empirically chosen to balance border removal and keeping the image intact.

Then  the Green channel is aligned to the Blue channel. And then the Red channel is aligned to the Blue channel. For the alignment, NCC was used. While aligning two channels, the assumption is made that two channels are no more than **+/-15%** displaced in translation, relative to the channel size. Empirically, that factor is generous in displacement. Furthermore, we only examine the inner **70%** of the images (without cropping the original any further). This ensures that the plate borders and the physical blemishes of the plate edges do not affect alignment.

So the search space over channel $$A$$ and channel $$B$$ is the double for-loop over displacements [-15%, 15%] vertically and [-15%, 15%] horizontally. (This factor works well for small images, but not for large images. Image pyramids are used to optimize this part.) The translated channel $$A$$ that receives the best NCC score is returned, as the best alignment to channel $$B$$.

Once Green and Blue are aligned, and Red and Blue are aligned, the three colors are stacked into a single image. The outputs are shown below.

## Image Pyramids

While searching over +/-15% displacement works for small images, it is inefficient for larger images. (For example, something over the size of 1000x1000 pixels.) To solve this inefficiency, image pyramids are implemented with a factor of 2.

Image pyramids are created for each channel. Say for channel $$A$$, the original image size is 2000x2000 pixels. A list of scaled-down images are produced based on that large image. In my implementation, I scale until both height and width are below 200 pixels. So for example, I would end up with a list of scaled images $$[(2000\times2000),(1000\times1000),(500\times500),(250\times250),(125\times125)].$$

This way, I can initially limit the alignment search space to the smallest image. The search becomes much faster. After the alignment is found for the smallest image, we search again in the image one step larger. In the one-step-larger search, we can do a rough alignment given by $$2 \times $$(the previous image's alignment). Note that pyramid has a scale factor of 2. Also, note that due to the rough alignment and the factor of 2, this current roughly aligned image is at most +/-2 pixels away from the optimal alignment to channel $$B$$ at this level. So at the current level, the search space can be limited to +/-2 pixels in each direction. (Just to be safe, I set the search space to +/-3 pixels. But empirically, all relative displacements are actually within [-2,2] pixels. Except for the Emir picture.)

After recursively finding the image alignments in the pyramid, the original image is efficiently aligned. This is much better than naively searching over [-15%, 15%] of 2000 pixels: 600x600 pixel search space.

Again, after alignment, the large original channels are stacked to create the output image.


<a href="/assets/webp/cs194-26/1/in/emir.webp"><img src="/assets/webp/cs194-26/1/in/emir.webp" class="img-responsive center-block" width="300px"></a>


## Results

The above algorithm worked well in almost every image. In the original 13 staff-provided images, only the Emir image failed to align well.

And in the 3 additional images downloaded from the Library of Congress, all 3 aligned well.(Plaque, House, and Closet).

I suspect Emir did not align well due to two reasons: First, the input channels have very different luminances. The bottom channel (Red) is relatively brighter than the others. And second, his clothing is very colorful and textured. In the grayscale top channel (Green), his clothing is white with black plants. In the grayscale middle (Blue), his clothing is overall gray. In the grayscale bottom (Red), his clothing is dark with white plants. This causes NCC to break down as a metric, as it prefers to align whites with whites and blacks with blacks.

Average runtime per image is less than 20 seconds. Total runtime is about 245.03612 seconds, or about 4 minutes for 16 images.

Under the assumption Prokudin-Gorskii used pure RGB filters, the RGB output images in the original algorithm has strong yellows and sepia tones. This suggests that while the RGB assumption is decent, Prokudin-Gorskii did not actually have pure RGB filters. Still overall, the images produced by this algorithm turned out pretty well.



## Aligned Images <small>(Images Clickable)</small>

All translational displacements are relative to Blue channel (top image). All of these displacements are in terms of absolute translation in pixels (not relative per level).

* small input images run on single-scale search (no pyramid processing necessary)
Key: **channel**[*Vertical* pixels, *Horizontal* pixels]</h4>

| | | | |
|-|-|-|-|
| <a href="/assets/webp/cs194-26/1/out_basic/cathedral_out.webp"> **Cathedral** <img src="/assets/webp/cs194-26/1/out_basic/cathedral_out.webp"></a> **G**[5 2]<br> **R**[12 3]<br>  **Runtime: 0.4774 secs** | <a href="/assets/webp/cs194-26/1/out_basic/emir_out.webp">**Emir** <img src="/assets/webp/cs194-26/1/out_basic/emir_out.webp"></a> **G**[49 24]<br> **R**[45 -303]<br>  **Runtime: 22.2336 secs** | <a href="/assets/webp/cs194-26/1/out_basic/harvesters_out.webp">**Harvesters** <img src="/assets/webp/cs194-26/1/out_basic/harvesters_out.webp"></a> **G**[59 16]<br> **R**[124 13]<br>  **Runtime: 20.4103 secs** | <a href="/assets/webp/cs194-26/1/out_basic/altar_out.webp">**Icon** <img src="/assets/webp/cs194-26/1/out_basic/altar_out.webp"></a> **G**[40 17]<br> **R**[89 23]<br>  **Runtime: 21.7114 secs** |
| <a href="/assets/webp/cs194-26/1/out_basic/lady_out.webp">**Lady** <img src="/assets/webp/cs194-26/1/out_basic/lady_out.webp"></a> **G**[48 9]<br> **R**[112 11]<br>  **Runtime: 9.9525 secs** | <a href="/assets/webp/cs194-26/1/out_basic/monastery_out.webp">** Monastery** <img src="/assets/webp/cs194-26/1/out_basic/monastery_out.webp"></a> **G**[-3 2]<br> **R**[3 2]<br>  **Runtime: 0.5933 secs** | <a href="/assets/webp/cs194-26/1/out_basic/nativity_out.webp">** Nativity** <img src="/assets/webp/cs194-26/1/out_basic/nativity_out.webp"></a> **G**[3 1]<br> **R**[7 0]<br>  **Runtime: 0.7132 secs** | <a href="/assets/webp/cs194-26/1/out_basic/self_portrait_out.webp">**Self** <img src="/assets/webp/cs194-26/1/out_basic/self_portrait_out.webp"></a> **G**[78 29]<br> **R**[176 37]<br>  **Runtime: 19.6527 secs** |
| <a href="/assets/webp/cs194-26/1/out_basic/settlers_out.webp">** Settlers** <img src="/assets/webp/cs194-26/1/out_basic/settlers_out.webp"></a> **G**[7 0]<br> **R**[14 -1]<br>  **Runtime: 0.5585 secs** | <a href="/assets/webp/cs194-26/1/out_basic/three_generations_out.webp">**Generations** <img src="/assets/webp/cs194-26/1/out_basic/three_generations_out.webp"></a> **G**[53 14]<br> **R**[112 11]<br>  **Runtime: 18.7443 secs** | <a href="/assets/webp/cs194-26/1/out_basic/train_out.webp">**Train** <img src="/assets/webp/cs194-26/1/out_basic/train_out.webp"></a> **G**[42 5]<br> **R**[87 32]<br>  **Runtime: 20.0464 secs** | <a href="/assets/webp/cs194-26/1/out_basic/turkmen_out.webp">**Turkmen** <img src="/assets/webp/cs194-26/1/out_basic/turkmen_out.webp"></a> **G**[56 21]<br> **R**[116 28]<br>  **Runtime: 21.6017 secs** |
| <a href="/assets/webp/cs194-26/1/out_basic/village_out.webp">**Village** <img src="/assets/webp/cs194-26/1/out_basic/village_out.webp"></a> **G**[65 12]<br> **R**[137 22]<br>  **Runtime: 21.0091 secs** | <a href="/assets/webp/cs194-26/1/out_basic/book_out.webp">**Plaque** <img src="/assets/webp/cs194-26/1/out_basic/book_out.webp"></a> **G**[62 19]<br> **R**[134 26]<br>  **Runtime: 19.7466 secs** | <a href="/assets/webp/cs194-26/1/out_basic/house_out.webp">**House** <img src="/assets/webp/cs194-26/1/out_basic/house_out.webp"></a> **G**[9 19]<br> **R**[35 38]<br>  **Runtime: 18.4928 secs** | <a href="/assets/webp/cs194-26/1/out_basic/closet_out.webp">**Closet** <img src="/assets/webp/cs194-26/1/out_basic/closet_out.webp"></a> **G**[36 -18]<br> **R**[102 -15]<br>  **Runtime: 19.07636 secs** |



# Going Further <small>(Image Enhancement)</small>
## Contrast Stretching

I also implemented a function which does Contrast Stretching (AKA Normalization) on any given channel. This Contrast Stretching function takes in 2D matrix of uint16 values, and remaps them such that the visual contrast of the channel is more noticeable.

Algorithmically, the matrix of uint16 values is first flattened into an array. Then the cumulative histogram of the array is calculated and normalized to [0.0,1.0]. The x-axis of the cumulative histogram has 65536 bins ranging from [0, 65535], and the y-axis is [0.0,1.0]. Define map $$T(x)$$ to be that cumulative histogram. Then for each pixel in the original channel (each element in the original matrix), the pixel is remapped to $$y=T(x)\times65535$$.

This remapping causes the channel to have better contrast. The non-cumulative histogram of the remapped image is uniform, and the cumulative histogram is a straight ramp.

As an example, here is the Contrast Stretching of the Red channel of Cathedral. Before and after.

| | |
|-|-|
| <a href="/assets/webp/cs194-26/1/compare/contrast_before.webp"><img src="/assets/webp/cs194-26/1/compare/contrast_before.webp" class="img-responsive center-block"></a> | <a href="/assets/webp/cs194-26/1/compare/contrast_after.webp"><img src="/assets/webp/cs194-26/1/compare/contrast_after.webp" class="img-responsive center-block"></a> |



## Contrast Stretching on RGB <small>(RGB Stretching)</small>

For the "RGB Stretching" set of images, I applied the Contrast Stretching function above to all three channels BEFORE alignment.

The alignment on the images turned out to be approximately the same as in the original algorithm. (Except Emir).

But the most noticeable difference is the change in colors. Overall, the colors seem much more vivid, saturated, and balanced. Additionally, the black-and-white contrast of the images are more noticeable well. On the whole, the set of images is cooler and more blue in comparison to the origin set. A few of the images are unrealistically colored however.

Under the assumption Prokudin-Gorskii used pure RGB filters, the RGB output images in the original algorithm has strong yellows and sepia tones. This suggests that while the RGB assumption is decent, Prokudin-Gorskii did not actually have pure RGB filters.

Due to the yellow biased images under the RGB model -- if the image does not have a good distribution of blue colors, the RGB Stretching function would make the output image too blue. (Blue is the complement to yellow.) Images with sufficient blue in them turn out very well though. See "Self" image vs "Lady" image.

Specific comparisons below.


## Contrast Stretching on Value of HSV <small>(HSV Value Stretching)</small>

Seeing that alignment did not change with the RGB Stretching, for the "HSV Value Stretching" set I did processing AFTER alignment. After aligning the images using the original algorithm, I converted the RGB image to HSV space. Note that the Value parameter in HSV corresponds to black-and-white contrast of images. Then I performed Contrast Stretching on that Value parameter. Essentially, this attempts to improve black-and-white contrast without changing the hues in the image. As shown below, this worked well.


## Contrast Stretching on SV of HSV <small>(HSV Saturation and Value Stretching)</small>

For the "HSV Saturation and Value Stretching" set, I did the same thing as HSV Value Stretching, but I also called the Contrast Stretching function on the Saturation parameter of HSV.

This change produced more realistically colored images than just Value Stretching. That saturation of colors seem to be better balanced, meaning nothing is too unsaturated or too saturated. But the images also seem less vivid overall.


## Alignment Over Scale and Rotation <small>(5D Transform)</small>

Based on the technology available to Prokudin-Gorskii, not all three panels in the image plates were perfectly captured at the exact same point in 3D space. As a result, the photos in each panel may be slightly out-of-scale with each other. (I.e. different zoom levels.) Furthermore, when the plates were transfered to a digital format, some of the panel photos may have been slightly rotated.

To account for this, we increase the dimesionality of the search space to include vertical scaling, horizontal scaling, and rotation, in addition to the original vertical and horizontal translation. For scaling, I assumed channel $$A$$ is no more than +/-5% scaled than channel $$B$$ in each direction. For downscaling channel $$A$$, I padded with gray (0.5) values; and for upscaling $$A$$, I had to crop out edge pixels. For rotation, I assumed channel $$A$$ is no more than +/-5 degrees rotated than channel $$B$$.

I took advantage of the recursive image pyramid approach to speed up the 5 dimesional search, but the large .tiff images took about half an hour each to process.

In terms of alignment, the results were worth it though:

<style>
table td, table td * {
    vertical-align: top;
}
</style>

| **Train, Original** | **Train, HSV Saturated and Value Stretched** | **Train, 5D Alignment** |
|-|-|-|
| <a href="/assets/webp/cs194-26/1/compare/train_out_basic.webp"><img src="/assets/webp/cs194-26/1/compare/train_out_basic.webp" class="img-responsive center-block"></a>Notice that the train's chimney has a band of yellow above it. Also notice the wheels in the original alignment, there is a band of yellow below it. This suggests the Green channel is misaligned in terms of vertical scale, relative to the other two channels. | <a href="/assets/webp/cs194-26/1/compare/train_out_hsv.webp"><img src="/assets/webp/cs194-26/1/compare/train_out_hsv.webp" class="img-responsive center-block"></a>This image is included to better see the yellow band above the chimney. | <a href="/assets/webp/cs194-26/1/compare/train_out_trans.webp"><img src="/assets/webp/cs194-26/1/compare/train_out_trans.webp" class="img-responsive center-block"></a>The yellow band is gone. The lantern rim is more defined, and the gold leaf is less blurry. This is a better alignment of the Green channel! |
|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|

## Final Comparisons <small>(Images Clickable)</small>

- Overall, HSV Value Stretching provides a better image than the original by boosting black-and-white contrast. HSV Saturation stretching provides a good color boost and balancing to the original, but can sometimes oversaturate the color to being unrealistic.
- RGB Stretching improves color balance, saturation, and contrast when the original images has sufficiently even amounts of yellows and blues. But if there is not enough natural blue range, the resulting image takes on a blue and purple tint.
- 5D alignment provides better image quality and alignment in most cases, but the difference is not as apparent as the color space operations.

Channels are relative to Blue.

Key: **channel**[*Vertical Translation* pixels, *Horizontal Translation* pixels, (*Vertical Scale*, *Horizontal Scale*, *Rotational Degrees*)]

| **Original Algorithm** | **RGB Stretching**|**HSV Value Stretching** | **HSV Saturation and Value Stretching** | **5D Transform** |
|-|-|-|-|-|
| <a href="/assets/webp/cs194-26/1/out_basic/cathedral_out.webp">**Cathedral** <img src="/assets/webp/cs194-26/1/out_basic/cathedral_out.webp"></a> **G**[5 2]<br> **R**[12 3]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/cathedral_out.webp">**Cathedral** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/cathedral_out.webp"></a> **G**[5 2]<br> **R**[12 3]<br> Better contrast than original, but unrealistic blues on the hillside. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_cathedral_out.webp">**Cathedral** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_cathedral_out.webp"></a> **G**[5 2]<br> **R**[12 3]<br> Better contrast than original. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/cathedral_out.webp">**Cathedral** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/cathedral_out.webp"></a> **G**[5 2]<br> **R**[12 3]<br> Better contrast than original and more vivid colors. | <a href="/assets/webp/cs194-26/1/out_transform/cathedral_out.webp">**Cathedral** <img src="/assets/webp/cs194-26/1/out_transform/cathedral_out.webp"></a> **G**[4 2 1.0125 1.0 0.0375]<br> **R**[3 -1 1.0375 1.0125 0.0125]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/emir_out.webp">**Emir** <img src="/assets/webp/cs194-26/1/out_basic/emir_out.webp"></a> **G**[49 24]<br> **R**[45 -303]<br> "I'm too blue." | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/emir_out.webp">**Emir** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/emir_out.webp"></a> **G**[49 24]<br> **R**[45 -303]<br> | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_emir_out.webp">**Emir** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_emir_out.webp"></a> **G**[49 24]<br> **R**[45 -303]<br> | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/emir_out.webp">**Emir** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/emir_out.webp"></a> **G**[49 24]<br> **R**[45 -303]<br> | <a href="/assets/webp/cs194-26/1/out_transform/emir_out.webp">**Emir** <img src="/assets/webp/cs194-26/1/out_transform/emir_out.webp"></a> **G**[8 11 1.01 1.0045 -0.03458]<br> **R**[-13 -175 0.9429 0.9429 -0.0470]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/harvesters_out.webp">**Harvesters** <img src="/assets/webp/cs194-26/1/out_basic/harvesters_out.webp"></a> **G**[59 16]<br> **R**[124 13]<br> Honestly, the lady who moved during the photo looks like a ghost and creeps me out a little. | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/harvesters_out.webp">**Harvesters** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/harvesters_out.webp"></a> **G**[59 16]<br> **R**[124 13]<br> More balanced coloring. Less sepia tones, but plants are bluer than in real life. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_harvesters_out.webp">**Harvesters** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_harvesters_out.webp"></a> **G**[59 16]<br> **R**[124 13]<br> Better contrast with fairly good colors. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/harvesters_out.webp">**Harvesters** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/harvesters_out.webp"></a> **G**[59 16]<br> **R**[124 13]<br> More vivid colors than previous image. | <a href="/assets/webp/cs194-26/1/out_transform/harvesters_out.webp">**Harvesters** <img src="/assets/webp/cs194-26/1/out_transform/harvesters_out.webp"></a> **G**[47 3 1.0060 1.0045 -0.0570]<br> **R**[116 9 1.0020 0.9991 -0.0570]<br> Slightly worse alignment than the original. The error could potentially be due to the high frequencies in the image, and the noise caused by the windy day. Notice the tall grass in the foreground. |
| <a href="/assets/webp/cs194-26/1/out_basic/altar_out.webp">**Icon** <img src="/assets/webp/cs194-26/1/out_basic/altar_out.webp"></a> **G**[40 17]<br> **R**[89 23]<br>  Very gold and yellow. Pretty good alignment to begin with. | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/altar_out.webp">**Icon** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/altar_out.webp"></a> **G**[40 17]<br> **R**[89 23]<br> As opposed to the above images, located in landscapes outside, this image has a more actual blue colors. This prevents the RGB scaling from becoming overly blue like in the above images. The fence and the blue dome has an appealing teal to it. The red and gold are strong without being overbearing. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_altar_out.webp">**Icon** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_altar_out.webp"></a> **G**[40 17]<br> **R**[89 23]<br> More contrast, the shadows helps bring out the gold coloring. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/altar_out.webp">**Icon** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/altar_out.webp"></a> **G**[40 17]<br> **R**[89 23]<br> Good contrast, with gold and red very saturated and strong. Weaker blues. | <a href="/assets/webp/cs194-26/1/out_transform/altar_out.webp">**Icon** <img src="/assets/webp/cs194-26/1/out_transform/altar_out.webp"></a> **G**[33 16 1.0035 1.0029 0.0116]<br> **R**[84 22 0.9991 1.0029 -0.0070]<br> About the same quality as original, slightly rotated. |
| <a href="/assets/webp/cs194-26/1/out_basic/lady_out.webp">**Lady** <img src="/assets/webp/cs194-26/1/out_basic/lady_out.webp"></a> **G**[48 9]<br> **R**[112 11]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/lady_out.webp">**Lady** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/lady_out.webp"></a> **G**[48 9]<br> **R**[112 11]<br> Much better coloring than original. I suspect the blue dress helps the RGB balance. More natural skin color than all the others. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_lady_out.webp">**Lady** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_lady_out.webp"></a> **G**[48 9]<br> **R**[112 11]<br> Decent image, although a bit gray overall. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/lady_out.webp">**Lady** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/lady_out.webp"></a> **G**[48 9]<br> **R**[112 11]<br> Medical attention recommended. | <a href="/assets/webp/cs194-26/1/out_transform/lady_out.webp">**Lady** <img src="/assets/webp/cs194-26/1/out_transform/lady_out.webp"></a> **G**[0 11 1.0106 0.9970 -0.0345]<br> **R**[45 3 1.0195 0.9991 0.0220]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/monastery_out.webp">**Monastery** <img src="/assets/webp/cs194-26/1/out_basic/monastery_out.webp"></a> **G**[-3 2]<br> **R**[3 2]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/monastery_out.webp">**Monastery** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/monastery_out.webp"></a> **G**[-3 2]<br> **R**[3 2]<br> Very vivid colors across the image. More pleasant to look at than the other images. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_monastery_out.webp">**Monastery** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_monastery_out.webp"></a> **G**[-3 2]<br> **R**[3 2]<br> A little too gray. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/monastery_out.webp">**Monastery** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/monastery_out.webp"></a> **G**[-3 2]<br> **R**[3 2]<br> | <a href="/assets/webp/cs194-26/1/out_transform/monastery_out.webp">**Monastery** <img src="/assets/webp/cs194-26/1/out_transform/monastery_out.webp"></a> **G**[1 2 1.0 1.0 -0.0375]<br> **R**[1 0 1.0 1.0 0.0375]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/nativity_out.webp">**Nativity** <img src="/assets/webp/cs194-26/1/out_basic/nativity_out.webp"></a> **G**[3 1]<br> **R**[7 0]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/nativity_out.webp">**Nativity** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/nativity_out.webp"></a> **G**[3 1]<br> **R**[7 0]<br> More neutral white colors, better than the others. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_nativity_out.webp">**Nativity** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_nativity_out.webp"></a> **G**[3 1]<br> **R**[7 0]<br> | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/nativity_out.webp">**Nativity** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/nativity_out.webp"></a> **G**[3 1]<br> **R**[7 0]<br> Very saturated colors. It almost looks like the building is outlined. | <a href="/assets/webp/cs194-26/1/out_transform/nativity_out.webp">**Nativity** <img src="/assets/webp/cs194-26/1/out_transform/nativity_out.webp"></a> **G**[0 -1 1.0125 1.0 -0.0375]<br> **R**[3 -1 1.0125 1.0062 -0.0375]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/self_portrait_out.webp">**Self** <img src="/assets/webp/cs194-26/1/out_basic/self_portrait_out.webp"></a> **G**[78 29]<br> **R**[176 37]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/self_portrait_out.webp">**Self** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/self_portrait_out.webp"></a> **G**[78 29]<br> **R**[176 37]<br> The blue is too strong once again. Notice the bottom left corner of the river. The water is unrealistically purple. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_self_portrait_out.webp">**Self** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_self_portrait_out.webp"></a> **G**[78 29]<br> **R**[176 37]<br> | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/self_portrait_out.webp">**Self** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/self_portrait_out.webp"></a> **G**[78 29]<br> **R**[176 37]<br>  Good coloring and contrast overall. | <a href="/assets/webp/cs194-26/1/out_transform/self_portrait_out.webp">**Self** <img src="/assets/webp/cs194-26/1/out_transform/self_portrait_out.webp"></a> **G**[53 23 1.0054 0.9991 -0.0539]<br> **R**[171 31 0.9991 0.9991 -0.0570]<br> The center of the image appears very in focus. Colors and alignment in that region is good. But, the edges of the picture are out of focus. Notice the alignment differences between the rock and the branches. The misalignment on the edges of the image give the illusion of depth-of-field. I suspect the high frequencies in the branches fooled the algorithm into misalignment. |
| <a href="/assets/webp/cs194-26/1/out_basic/settlers_out.webp">**Settlers** <img src="/assets/webp/cs194-26/1/out_basic/settlers_out.webp"></a> **G**[7 0]<br> **R**[14 -1]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/settlers_out.webp">**Settlers** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/settlers_out.webp"></a> **G**[7 0]<br> **R**[14 -1]<br> Good color saturation and contrast. May be a little too blue once again, as there is not much blue in the background. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_settlers_out.webp">**Settlers** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_settlers_out.webp"></a> **G**[7 0]<br> **R**[14 -1]<br> Good contrast with already decent colors. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/settlers_out.webp">**Settlers** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/settlers_out.webp"></a> **G**[7 0]<br> **R**[14 -1]<br> Good contrast, but overcompensates the color too much. Notice the purple shadow on the upper left corner. | <a href="/assets/webp/cs194-26/1/out_transform/settlers_out.webp">**Settlers** <img src="/assets/webp/cs194-26/1/out_transform/settlers_out.webp"></a> **G**[3 -1 1.0062 1.0062 -0.0375]<br> **R**[9 -2 1.0125 1.0062 0.0]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/three_generations_out.webp">**Generations** <img src="/assets/webp/cs194-26/1/out_basic/three_generations_out.webp"></a> **G**[53 14]<br> **R**[112 11]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/three_generations_out.webp">**Generations** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/three_generations_out.webp"></a> **G**[53 14]<br> **R**[112 11]<br> Good color balance, owing to the blue background. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_three_generations_out.webp">**Generations** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_three_generations_out.webp"></a> **G**[53 14]<br> **R**[112 11]<br> | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/three_generations_out.webp">**Generations** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/three_generations_out.webp"></a> **G**[53 14]<br> **R**[112 11]<br> The blue is too saturated in this case. | <a href="/assets/webp/cs194-26/1/out_transform/three_generations_out.webp">**Generations** <img src="/assets/webp/cs194-26/1/out_transform/three_generations_out.webp"></a> **G**[44 7 1.0035 1.0035 -0.0570]<br> **R**[109 6 1.0029 0.9991 0.0179]<br> Better alignment of all filters. Notice the woman's hat - it no longer has a yellow outline. Notice the left man's hat, the green and yellow outlines are removed. The same man's waist belt no longer has a blue outline. The chromatic aberation on the left man's big medal is reduced. It is originally circled by a rainbow of red, purple, blue, green, yellow. Now it is only red and cyan offset. The vertical gold belt has red borders removed as well. |
| <a href="/assets/webp/cs194-26/1/out_basic/train_out.webp">**Train** <img src="/assets/webp/cs194-26/1/out_basic/train_out.webp"></a> **G**[42 5]<br> **R**[87 32]<br> A bright image of a train. | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/train_out.webp">**Train** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/train_out.webp"></a> **G**[42 5]<br> **R**[87 32]<br> The brightness of the image is toned down. The colors here makes the image look like it was taken at sunrise or sunset rather than near noon. The shadows in the image show that it is actually around noon though, so this coloring is unrealistic. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_train_out.webp">**Train** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_train_out.webp"></a> **G**[42 5]<br> **R**[87 32]<br> Same comment as RGB contrast. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/train_out.webp">**Train** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/train_out.webp"></a> **G**[42 5]<br> **R**[87 32]<br> Too blue and dark for noon. | <a href="/assets/webp/cs194-26/1/out_transform/train_out.webp">**Train** <img src="/assets/webp/cs194-26/1/out_transform/train_out.webp"></a> **G**[35 -4 1.0035 1.0002 -0.0570]<br> **R**[9 15 1.0035 1.007 -0.0570]<br> Notice the chimney: The yellow band is gone. The lantern rim is more defined, and the gold leaf is less blurry. The train tracks on the bottom right have also improved, reducing yellow and magenta borders. |
| <a href="/assets/webp/cs194-26/1/out_basic/turkmen_out.webp">**Turkmen** <img src="/assets/webp/cs194-26/1/out_basic/turkmen_out.webp"></a> **G**[56 21]<br> **R**[116 28]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/turkmen_out.webp">**Turkmen** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/turkmen_out.webp"></a> **G**[56 21]<br> **R**[116 28]<br> Again, the lack of blues make this contrast stretched image appear too blue. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_turkmen_out.webp">**Turkmen** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_turkmen_out.webp"></a> **G**[56 21]<br> **R**[116 28]<br> Good contrast, but very gray. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/turkmen_out.webp">**Turkmen** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/turkmen_out.webp"></a> **G**[56 21]<br> **R**[116 28]<br> Good contrast and color saturation. | <a href="/assets/webp/cs194-26/1/out_transform/turkmen_out.webp">**Turkmen** <img src="/assets/webp/cs194-26/1/out_transform/turkmen_out.webp"></a> **G**[54 13 1.0029 1.0016 0.0179]<br> **R**[116 24 1.0014 0.9991 -0.0508]<br> Improvement in the coloring of the rope that the man is holding. |
| <a href="/assets/webp/cs194-26/1/out_basic/village_out.webp">**Village** <img src="/assets/webp/cs194-26/1/out_basic/village_out.webp"></a> **G**[65 12]<br> **R**[137 22]<br> | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/village_out.webp">**Village** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/village_out.webp"></a> **G**[65 12]<br> **R**[137 22]<br> More vivd colors compared to the original. Hover, parts of the sand on the bottom of the image appear purple and unrealistic. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_village_out.webp">**Village** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_village_out.webp"></a> **G**[65 12]<br> **R**[137 22]<br> | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/village_out.webp">**Village** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/village_out.webp"></a> **G**[65 12]<br> **R**[137 22]<br> Very saturated colors, making the photo appear unrealistic. Even stronger blue tones than the RGB Stretched image. | <a href="/assets/webp/cs194-26/1/out_transform/village_out.webp">**Village** <img src="/assets/webp/cs194-26/1/out_transform/village_out.webp"></a> **G**[53 7 1.0239 0.9991 -0.0356]<br> **R**[137 21 1.0006 1.0029 -0.0345]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/book_out.webp">**Plaque** <img src="/assets/webp/cs194-26/1/out_basic/book_out.webp"></a> **G**[62 19]<br> **R**[134 26]<br> Image is biased towards blue instead of yellow. | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/book_out.webp">**Plaque** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/book_out.webp"></a> **G**[62 19]<br> **R**[134 26]<br> Very well balanced colors with good saturation. Removes the blue tint. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_book_out.webp">**Plaque** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_book_out.webp"></a> **G**[62 19]<br> **R**[134 26]<br> | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/book_out.webp">**Plaque** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/book_out.webp"></a> **G**[62 19]<br> **R**[134 26]<br> Unpleasantly blue. | <a href="/assets/webp/cs194-26/1/out_transform/book_out.webp">**Plaque** <img src="/assets/webp/cs194-26/1/out_transform/book_out.webp"></a> **G**[48 11 1.0054 1.0035 -0.0345]<br> **R**[103 7 1.0054 1.0070 -0.0377]<br> |
| <a href="/assets/webp/cs194-26/1/out_basic/house_out.webp">**House** <img src="/assets/webp/cs194-26/1/out_basic/house_out.webp"></a> **G**[9 19]<br> **R**[35 38]<br> Looks like a picture from the 70s. | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/house_out.webp">**House** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/house_out.webp"></a> **G**[9 19]<br> **R**[35 38]<br> Better contrast and greens, but a little on the blue side. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_house_out.webp">**House** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_house_out.webp"></a> **G**[9 19]<br> **R**[35 38]<br> A little gray. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/house_out.webp">**House** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/house_out.webp"></a> **G**[9 19]<br> **R**[35 38]<br> Very saturated colors in addition to contrast. This makes the wood look damp. | <a href="/assets/webp/cs194-26/1/out_transform/house_out.webp">**House** <img src="/assets/webp/cs194-26/1/out_transform/house_out.webp"></a> **G**[-2 4 1.0045 1.0070 0.02416]<br> **R**[28 23 1.0035 1.0070 -0.0320]<br> Better alignment and sharpness on the house edges. Notice the roof edges, doorway, and windows on the bottom left corner. |
| <a href="/assets/webp/cs194-26/1/out_basic/closet_out.webp">**Closet** <img src="/assets/webp/cs194-26/1/out_basic/closet_out.webp"></a> **G**[36 -18]<br> **R**[102 -15]<br> Already a good image, gives the impression that it was taken indoors with a fairly modern camera. Decent colors. | <a href="/assets/webp/cs194-26/1/out_rgb_contrast/closet_out.webp">**Closet** <img src="/assets/webp/cs194-26/1/out_rgb_contrast/closet_out.webp"></a> **G**[36 -18]<br> **R**[102 -15]<br> Very bright and washed out colors, likely due to overcompensating for blues once again. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_closet_out.webp">**Closet** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/no_s_closet_out.webp"></a> **G**[36 -18]<br> **R**[102 -15]<br> Fairly realstic shadows and contrast for an indoor image. | <a href="/assets/webp/cs194-26/1/out_hsv_contrast/closet_out.webp">**Closet** <img src="/assets/webp/cs194-26/1/out_hsv_contrast/closet_out.webp"></a> **G**[36 -18]<br> **R**[102 -15]<br> Good contrast and saturation. Saturation borderlines on being unrealistic, but is still pretty good. | <a href="/assets/webp/cs194-26/1/out_transform/closet_out.webp">**Closet** <img src="/assets/webp/cs194-26/1/out_transform/closet_out.webp"></a> **G**[29 -24 0.9991 1.0035 -0.0570]<br> **R**[100 -16 1.0029 1.0029 -0.0445]<br> About the same as the original, which was already fairly well aligned.
|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|


## Possible Improvements
The photograph of Emir did not align well using the NCC metric, due to the inversion of intensities on his coat between the different color channels. One possible improvement would be to use another metric, such as Mutual Information, which is agnostic to that inversion and instead focuses more on scoring the alignment of shapes within the images.

